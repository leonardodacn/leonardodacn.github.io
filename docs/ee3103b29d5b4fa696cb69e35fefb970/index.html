<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DataX MysqlWriter | haokiu</title>
<meta name="keywords" content="datax">
<meta name="description" content="DataX MysqlWriter 1 快速介绍 MysqlWriter 插件实现了写入数据到 Mysql 主库的目的表的功能。在底层实现上， MysqlWriter 通过 JDBC 连接远程 Mysql 数据库，并执行相应的 insert into &hellip; 或者 ( replace into &hellip;) 的 sql 语句将数据写入 Mysql，内部会分批次提交入库，需要数据库本身采用 innodb 引擎。
MysqlWriter 面向ETL开发工程师，他们使用 MysqlWriter 从数仓导入数据到 Mysql。同时 MysqlWriter 亦可以作为数据迁移工具为DBA等用户提供服务。
2 实现原理 MysqlWriter 通过 DataX 框架获取 Reader 生成的协议数据，根据你配置的 writeMode 生成
insert into...(当主键/唯一性索引冲突时会写不进去冲突的行) 或者 replace into...(没有遇到主键/唯一性索引冲突时，与 insert into 行为一致，冲突时会用新行替换原有行所有字段) 的语句写入数据到 Mysql。出于性能考虑，采用了 PreparedStatement &#43; Batch，并且设置了：rewriteBatchedStatements=true，将数据缓冲到线程上下文 Buffer 中，当 Buffer 累计到预定阈值时，才发起写入请求。 注意：目的表所在数据库必须是主库才能写入数据；整个任务至少需要具备 insert/replace into...的权限，是否需要其他权限，取决于你任务配置中在 preSql 和 postSql 中指定的语句。 3 功能说明 3.1 配置样例 这里使用一份从内存产生到 Mysql 导入的数据。 { &#34;job&#34;: { &#34;setting&#34;: { &#34;speed&#34;: { &#34;channel&#34;: 1 } }, &#34;content&#34;: [ { &#34;reader&#34;: { &#34;name&#34;: &#34;streamreader&#34;, &#34;parameter&#34;: { &#34;column&#34; : [ { &#34;value&#34;: &#34;DataX&#34;, &#34;type&#34;: &#34;string&#34; }, { &#34;value&#34;: 19880808, &#34;type&#34;: &#34;long&#34; }, { &#34;value&#34;: &#34;1988-08-08 08:08:08&#34;, &#34;type&#34;: &#34;date&#34; }, { &#34;value&#34;: true, &#34;type&#34;: &#34;bool&#34; }, { &#34;value&#34;: &#34;test&#34;, &#34;type&#34;: &#34;bytes&#34; } ], &#34;sliceRecordCount&#34;: 1000 } }, &#34;writer&#34;: { &#34;name&#34;: &#34;mysqlwriter&#34;, &#34;parameter&#34;: { &#34;writeMode&#34;: &#34;insert&#34;, &#34;username&#34;: &#34;root&#34;, &#34;password&#34;: &#34;root&#34;, &#34;column&#34;: [ &#34;id&#34;, &#34;name&#34; ], &#34;session&#34;: [ &#34;set session sql_mode=&#39;ANSI&#39;&#34; ], &#34;preSql&#34;: [ &#34;delete from test&#34; ], &#34;connection&#34;: [ { &#34;jdbcUrl&#34;: &#34;jdbc:mysql://127.">
<meta name="author" content="">
<link rel="canonical" href="https://haokiu.com/ee3103b29d5b4fa696cb69e35fefb970/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://haokiu.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://haokiu.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://haokiu.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://haokiu.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://haokiu.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="DataX MysqlWriter" />
<meta property="og:description" content="DataX MysqlWriter 1 快速介绍 MysqlWriter 插件实现了写入数据到 Mysql 主库的目的表的功能。在底层实现上， MysqlWriter 通过 JDBC 连接远程 Mysql 数据库，并执行相应的 insert into &hellip; 或者 ( replace into &hellip;) 的 sql 语句将数据写入 Mysql，内部会分批次提交入库，需要数据库本身采用 innodb 引擎。
MysqlWriter 面向ETL开发工程师，他们使用 MysqlWriter 从数仓导入数据到 Mysql。同时 MysqlWriter 亦可以作为数据迁移工具为DBA等用户提供服务。
2 实现原理 MysqlWriter 通过 DataX 框架获取 Reader 生成的协议数据，根据你配置的 writeMode 生成
insert into...(当主键/唯一性索引冲突时会写不进去冲突的行) 或者 replace into...(没有遇到主键/唯一性索引冲突时，与 insert into 行为一致，冲突时会用新行替换原有行所有字段) 的语句写入数据到 Mysql。出于性能考虑，采用了 PreparedStatement &#43; Batch，并且设置了：rewriteBatchedStatements=true，将数据缓冲到线程上下文 Buffer 中，当 Buffer 累计到预定阈值时，才发起写入请求。 注意：目的表所在数据库必须是主库才能写入数据；整个任务至少需要具备 insert/replace into...的权限，是否需要其他权限，取决于你任务配置中在 preSql 和 postSql 中指定的语句。 3 功能说明 3.1 配置样例 这里使用一份从内存产生到 Mysql 导入的数据。 { &#34;job&#34;: { &#34;setting&#34;: { &#34;speed&#34;: { &#34;channel&#34;: 1 } }, &#34;content&#34;: [ { &#34;reader&#34;: { &#34;name&#34;: &#34;streamreader&#34;, &#34;parameter&#34;: { &#34;column&#34; : [ { &#34;value&#34;: &#34;DataX&#34;, &#34;type&#34;: &#34;string&#34; }, { &#34;value&#34;: 19880808, &#34;type&#34;: &#34;long&#34; }, { &#34;value&#34;: &#34;1988-08-08 08:08:08&#34;, &#34;type&#34;: &#34;date&#34; }, { &#34;value&#34;: true, &#34;type&#34;: &#34;bool&#34; }, { &#34;value&#34;: &#34;test&#34;, &#34;type&#34;: &#34;bytes&#34; } ], &#34;sliceRecordCount&#34;: 1000 } }, &#34;writer&#34;: { &#34;name&#34;: &#34;mysqlwriter&#34;, &#34;parameter&#34;: { &#34;writeMode&#34;: &#34;insert&#34;, &#34;username&#34;: &#34;root&#34;, &#34;password&#34;: &#34;root&#34;, &#34;column&#34;: [ &#34;id&#34;, &#34;name&#34; ], &#34;session&#34;: [ &#34;set session sql_mode=&#39;ANSI&#39;&#34; ], &#34;preSql&#34;: [ &#34;delete from test&#34; ], &#34;connection&#34;: [ { &#34;jdbcUrl&#34;: &#34;jdbc:mysql://127." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://haokiu.com/ee3103b29d5b4fa696cb69e35fefb970/" /><meta property="article:section" content="4" />
<meta property="article:published_time" content="2021-02-02T17:45:01+00:00" />
<meta property="article:modified_time" content="2021-02-02T17:45:01+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DataX MysqlWriter"/>
<meta name="twitter:description" content="DataX MysqlWriter 1 快速介绍 MysqlWriter 插件实现了写入数据到 Mysql 主库的目的表的功能。在底层实现上， MysqlWriter 通过 JDBC 连接远程 Mysql 数据库，并执行相应的 insert into &hellip; 或者 ( replace into &hellip;) 的 sql 语句将数据写入 Mysql，内部会分批次提交入库，需要数据库本身采用 innodb 引擎。
MysqlWriter 面向ETL开发工程师，他们使用 MysqlWriter 从数仓导入数据到 Mysql。同时 MysqlWriter 亦可以作为数据迁移工具为DBA等用户提供服务。
2 实现原理 MysqlWriter 通过 DataX 框架获取 Reader 生成的协议数据，根据你配置的 writeMode 生成
insert into...(当主键/唯一性索引冲突时会写不进去冲突的行) 或者 replace into...(没有遇到主键/唯一性索引冲突时，与 insert into 行为一致，冲突时会用新行替换原有行所有字段) 的语句写入数据到 Mysql。出于性能考虑，采用了 PreparedStatement &#43; Batch，并且设置了：rewriteBatchedStatements=true，将数据缓冲到线程上下文 Buffer 中，当 Buffer 累计到预定阈值时，才发起写入请求。 注意：目的表所在数据库必须是主库才能写入数据；整个任务至少需要具备 insert/replace into...的权限，是否需要其他权限，取决于你任务配置中在 preSql 和 postSql 中指定的语句。 3 功能说明 3.1 配置样例 这里使用一份从内存产生到 Mysql 导入的数据。 { &#34;job&#34;: { &#34;setting&#34;: { &#34;speed&#34;: { &#34;channel&#34;: 1 } }, &#34;content&#34;: [ { &#34;reader&#34;: { &#34;name&#34;: &#34;streamreader&#34;, &#34;parameter&#34;: { &#34;column&#34; : [ { &#34;value&#34;: &#34;DataX&#34;, &#34;type&#34;: &#34;string&#34; }, { &#34;value&#34;: 19880808, &#34;type&#34;: &#34;long&#34; }, { &#34;value&#34;: &#34;1988-08-08 08:08:08&#34;, &#34;type&#34;: &#34;date&#34; }, { &#34;value&#34;: true, &#34;type&#34;: &#34;bool&#34; }, { &#34;value&#34;: &#34;test&#34;, &#34;type&#34;: &#34;bytes&#34; } ], &#34;sliceRecordCount&#34;: 1000 } }, &#34;writer&#34;: { &#34;name&#34;: &#34;mysqlwriter&#34;, &#34;parameter&#34;: { &#34;writeMode&#34;: &#34;insert&#34;, &#34;username&#34;: &#34;root&#34;, &#34;password&#34;: &#34;root&#34;, &#34;column&#34;: [ &#34;id&#34;, &#34;name&#34; ], &#34;session&#34;: [ &#34;set session sql_mode=&#39;ANSI&#39;&#34; ], &#34;preSql&#34;: [ &#34;delete from test&#34; ], &#34;connection&#34;: [ { &#34;jdbcUrl&#34;: &#34;jdbc:mysql://127."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "4s",
      "item": "https://haokiu.com/4/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "DataX MysqlWriter",
      "item": "https://haokiu.com/ee3103b29d5b4fa696cb69e35fefb970/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DataX MysqlWriter",
  "name": "DataX MysqlWriter",
  "description": "DataX MysqlWriter 1 快速介绍 MysqlWriter 插件实现了写入数据到 Mysql 主库的目的表的功能。在底层实现上， MysqlWriter 通过 JDBC 连接远程 Mysql 数据库，并执行相应的 insert into \u0026hellip; 或者 ( replace into \u0026hellip;) 的 sql 语句将数据写入 Mysql，内部会分批次提交入库，需要数据库本身采用 innodb 引擎。\nMysqlWriter 面向ETL开发工程师，他们使用 MysqlWriter 从数仓导入数据到 Mysql。同时 MysqlWriter 亦可以作为数据迁移工具为DBA等用户提供服务。\n2 实现原理 MysqlWriter 通过 DataX 框架获取 Reader 生成的协议数据，根据你配置的 writeMode 生成\ninsert into...(当主键/唯一性索引冲突时会写不进去冲突的行) 或者 replace into...(没有遇到主键/唯一性索引冲突时，与 insert into 行为一致，冲突时会用新行替换原有行所有字段) 的语句写入数据到 Mysql。出于性能考虑，采用了 PreparedStatement + Batch，并且设置了：rewriteBatchedStatements=true，将数据缓冲到线程上下文 Buffer 中，当 Buffer 累计到预定阈值时，才发起写入请求。 注意：目的表所在数据库必须是主库才能写入数据；整个任务至少需要具备 insert/replace into...的权限，是否需要其他权限，取决于你任务配置中在 preSql 和 postSql 中指定的语句。 3 功能说明 3.1 配置样例 这里使用一份从内存产生到 Mysql 导入的数据。 { \u0026#34;job\u0026#34;: { \u0026#34;setting\u0026#34;: { \u0026#34;speed\u0026#34;: { \u0026#34;channel\u0026#34;: 1 } }, \u0026#34;content\u0026#34;: [ { \u0026#34;reader\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;streamreader\u0026#34;, \u0026#34;parameter\u0026#34;: { \u0026#34;column\u0026#34; : [ { \u0026#34;value\u0026#34;: \u0026#34;DataX\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; }, { \u0026#34;value\u0026#34;: 19880808, \u0026#34;type\u0026#34;: \u0026#34;long\u0026#34; }, { \u0026#34;value\u0026#34;: \u0026#34;1988-08-08 08:08:08\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;date\u0026#34; }, { \u0026#34;value\u0026#34;: true, \u0026#34;type\u0026#34;: \u0026#34;bool\u0026#34; }, { \u0026#34;value\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;bytes\u0026#34; } ], \u0026#34;sliceRecordCount\u0026#34;: 1000 } }, \u0026#34;writer\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;mysqlwriter\u0026#34;, \u0026#34;parameter\u0026#34;: { \u0026#34;writeMode\u0026#34;: \u0026#34;insert\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;root\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;root\u0026#34;, \u0026#34;column\u0026#34;: [ \u0026#34;id\u0026#34;, \u0026#34;name\u0026#34; ], \u0026#34;session\u0026#34;: [ \u0026#34;set session sql_mode=\u0026#39;ANSI\u0026#39;\u0026#34; ], \u0026#34;preSql\u0026#34;: [ \u0026#34;delete from test\u0026#34; ], \u0026#34;connection\u0026#34;: [ { \u0026#34;jdbcUrl\u0026#34;: \u0026#34;jdbc:mysql://127.",
  "keywords": [
    "datax"
  ],
  "articleBody": "DataX MysqlWriter 1 快速介绍 MysqlWriter 插件实现了写入数据到 Mysql 主库的目的表的功能。在底层实现上， MysqlWriter 通过 JDBC 连接远程 Mysql 数据库，并执行相应的 insert into … 或者 ( replace into …) 的 sql 语句将数据写入 Mysql，内部会分批次提交入库，需要数据库本身采用 innodb 引擎。\nMysqlWriter 面向ETL开发工程师，他们使用 MysqlWriter 从数仓导入数据到 Mysql。同时 MysqlWriter 亦可以作为数据迁移工具为DBA等用户提供服务。\n2 实现原理 MysqlWriter 通过 DataX 框架获取 Reader 生成的协议数据，根据你配置的 writeMode 生成\ninsert into...(当主键/唯一性索引冲突时会写不进去冲突的行) 或者 replace into...(没有遇到主键/唯一性索引冲突时，与 insert into 行为一致，冲突时会用新行替换原有行所有字段) 的语句写入数据到 Mysql。出于性能考虑，采用了 PreparedStatement + Batch，并且设置了：rewriteBatchedStatements=true，将数据缓冲到线程上下文 Buffer 中，当 Buffer 累计到预定阈值时，才发起写入请求。 注意：目的表所在数据库必须是主库才能写入数据；整个任务至少需要具备 insert/replace into...的权限，是否需要其他权限，取决于你任务配置中在 preSql 和 postSql 中指定的语句。 3 功能说明 3.1 配置样例 这里使用一份从内存产生到 Mysql 导入的数据。 { \"job\": { \"setting\": { \"speed\": { \"channel\": 1 } }, \"content\": [ { \"reader\": { \"name\": \"streamreader\", \"parameter\": { \"column\" : [ { \"value\": \"DataX\", \"type\": \"string\" }, { \"value\": 19880808, \"type\": \"long\" }, { \"value\": \"1988-08-08 08:08:08\", \"type\": \"date\" }, { \"value\": true, \"type\": \"bool\" }, { \"value\": \"test\", \"type\": \"bytes\" } ], \"sliceRecordCount\": 1000 } }, \"writer\": { \"name\": \"mysqlwriter\", \"parameter\": { \"writeMode\": \"insert\", \"username\": \"root\", \"password\": \"root\", \"column\": [ \"id\", \"name\" ], \"session\": [ \"set session sql_mode='ANSI'\" ], \"preSql\": [ \"delete from test\" ], \"connection\": [ { \"jdbcUrl\": \"jdbc:mysql://127.0.0.1:3306/datax?useUnicode=true\u0026characterEncoding=gbk\", \"table\": [ \"test\" ] } ] } } } ] } } 3.2 参数说明 jdbcUrl\n描述：目的数据库的 JDBC 连接信息。作业运行时，DataX 会在你提供的 jdbcUrl 后面追加如下属性：yearIsDateType=false\u0026zeroDateTimeBehavior=convertToNull\u0026rewriteBatchedStatements=true\n注意：1、在一个数据库上只能配置一个 jdbcUrl 值。这与 MysqlReader 支持多个备库探测不同，因为此处不支持同一个数据库存在多个主库的情况(双主导入数据情况) 2、jdbcUrl按照Mysql官方规范，并可以填写连接附加控制信息，比如想指定连接编码为 gbk ，则在 jdbcUrl 后面追加属性 useUnicode=true\u0026characterEncoding=gbk。具体请参看 Mysql官方文档或者咨询对应 DBA。 必选：是 默认值：无 username\n描述：目的数据库的用户名 必选：是 默认值：无 password\n描述：目的数据库的密码 必选：是 默认值：无 table\n描述：目的表的表名称。支持写入一个或者多个表。当配置为多张表时，必须确保所有表结构保持一致。\n注意：table 和 jdbcUrl 必须包含在 connection 配置单元中 必选：是 默认值：无 column\n描述：目的表需要写入数据的字段,字段之间用英文逗号分隔。例如: “column”: [“id”,“name”,“age”]。如果要依次写入全部列，使用*表示, 例如: \"column\": [\"*\"]。\n**column配置项必须指定，不能留空！** 注意：1、我们强烈不推荐你这样配置，因为当你目的表字段个数、类型等有改动时，你的任务可能运行不正确或者失败 2、 column 不能配置任何常量值 必选：是 默认值：否 session\n描述: DataX在获取Mysql连接时，执行session指定的SQL语句，修改当前connection session属性\n必须: 否\n默认值: 空\npreSql\n描述：写入数据到目的表前，会先执行这里的标准语句。如果 Sql 中有你需要操作到的表名称，请使用 @table 表示，这样在实际执行 Sql 语句时，会对变量按照实际表名称进行替换。比如你的任务是要写入到目的端的100个同构分表(表名称为:datax_00,datax01, … datax_98,datax_99)，并且你希望导入数据前，先对表中数据进行删除操作，那么你可以这样配置：\"preSql\":[\"delete from 表名\"]，效果是：在执行到每个表写入数据前，会先执行对应的 delete from 对应表名称 必选：否 默认值：无 postSql\n描述：写入数据到目的表后，会执行这里的标准语句。（原理同 preSql ） 必选：否 默认值：无 writeMode\n描述：控制写入数据到目标表采用 insert into 或者 replace into 或者 ON DUPLICATE KEY UPDATE 语句\n必选：是 所有选项：insert/replace/update 默认值：insert batchSize\n描述：一次性批量提交的记录数大小，该值可以极大减少DataX与Mysql的网络交互次数，并提升整体吞吐量。但是该值设置过大可能会造成DataX运行进程OOM情况。\n必选：否 默认值：1024 3.3 类型转换 类似 MysqlReader ，目前 MysqlWriter 支持大部分 Mysql 类型，但也存在部分个别类型没有支持的情况，请注意检查你的类型。\n下面列出 MysqlWriter 针对 Mysql 类型转换列表:\nDataX 内部类型 Mysql 数据类型 Long int, tinyint, smallint, mediumint, int, bigint, year Double float, double, decimal String varchar, char, tinytext, text, mediumtext, longtext Date date, datetime, timestamp, time Boolean bit, bool Bytes tinyblob, mediumblob, blob, longblob, varbinary bit类型目前是未定义类型转换 4 性能报告 4.1 环境准备 4.1.1 数据特征 建表语句：\nCREATE TABLE `datax_mysqlwriter_perf_00` ( `biz_order_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `key_value` varchar(4000) NOT NULL COMMENT 'Key-value的内容', `gmt_create` datetime NOT NULL COMMENT '创建时间', `gmt_modified` datetime NOT NULL COMMENT '修改时间', `attribute_cc` int(11) DEFAULT NULL COMMENT '防止并发修改的标志', `value_type` int(11) NOT NULL DEFAULT '0' COMMENT '类型', `buyer_id` bigint(20) DEFAULT NULL COMMENT 'buyerid', `seller_id` bigint(20) DEFAULT NULL COMMENT 'seller_id', PRIMARY KEY (`biz_order_id`,`value_type`), KEY `idx_biz_vertical_gmtmodified` (`gmt_modified`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='datax perf test' 单行记录类似于：\nkey_value: ;orderIds:20148888888,2014888888813800; gmt_create: 2011-09-24 11:07:20 gmt_modified: 2011-10-24 17:56:34 attribute_cc: 1 value_type: 3 buyer_id: 8888888 seller_id: 1 4.1.2 机器参数 执行DataX的机器参数为:\ncpu: 24核 Intel(R) Xeon(R) CPU E5-2630 0 @ 2.30GHz mem: 48GB net: 千兆双网卡 disc: DataX 数据不落磁盘，不统计此项 Mysql数据库机器参数为:\ncpu: 32核 Intel(R) Xeon(R) CPU E5-2650 v2 @ 2.60GHz mem: 256GB net: 千兆双网卡 disc: BTWL419303E2800RGN INTEL SSDSC2BB800G4 D2010370 4.1.3 DataX jvm 参数 -Xms1024m -Xmx1024m -XX:+HeapDumpOnOutOfMemoryError 4.2 测试报告 4.2.1 单表测试报告 通道数 批量提交行数 DataX速度(Rec/s) DataX流量(MB/s) DataX机器网卡流出流量(MB/s) DataX机器运行负载 DB网卡进入流量(MB/s) DB运行负载 DB TPS 1 128 5319 0.260 0.580 0.05 0.620 0.5 50 1 512 14285 0.697 1.6 0.12 1.6 0.6 28 1 1024 17241 0.842 1.9 0.20 1.9 0.6 16 1 2048 31250 1.49 2.8 0.15 3.0 0.8 15 1 4096 31250 1.49 3.5 0.20 3.6 0.8 8 4 128 11764 0.574 1.5 0.21 1.6 0.8 112 4 512 30769 1.47 3.5 0.3 3.6 0.9 88 4 1024 50000 2.38 5.4 0.3 5.5 1.0 66 4 2048 66666 3.18 7.0 0.3 7.1 1.37 46 4 4096 80000 3.81 7.3 0.5 7.3 1.40 26 8 128 17777 0.868 2.9 0.28 2.9 0.8 200 8 512 57142 2.72 8.5 0.5 8.5 0.70 159 8 1024 88888 4.24 12.2 0.9 12.4 1.0 108 8 2048 133333 6.36 14.7 0.9 14.7 1.0 81 8 4096 166666 7.95 19.5 0.9 19.5 3.0 45 16 128 32000 1.53 3.3 0.6 3.4 0.88 401 16 512 106666 5.09 16.1 0.9 16.2 2.16 260 16 1024 173913 8.29 22.1 1.5 22.2 4.5 200 16 2048 228571 10.90 28.6 1.61 28.7 4.60 128 16 4096 246153 11.74 31.1 1.65 31.2 4.66 57 32 1024 246153 11.74 30.5 3.17 30.7 12.10 270 说明：\n这里的单表，主键类型为 bigint(20),自增。 batchSize 和 通道个数，对性能影响较大。 16通道，4096批量提交时，出现 full gc 2次。 4.2.2 分表测试报告(2个分库，每个分库4张分表，共计8张分表) 通道数 批量提交行数 DataX速度(Rec/s) DataX流量(MB/s) DataX机器网卡流出流量(MB/s) DataX机器运行负载 DB网卡进入流量(MB/s) DB运行负载 DB TPS 8 128 26764 1.28 2.9 0.5 3.0 0.8 209 8 512 95180 4.54 10.5 0.7 10.9 0.8 188 8 1024 94117 4.49 12.3 0.6 12.4 1.09 120 8 2048 133333 6.36 19.4 0.9 19.5 1.35 85 8 4096 191692 9.14 22.1 1.0 22.2 1.45 45 4.2.3 分表测试报告(2个分库，每个分库8张分表，共计16张分表) 通道数 批量提交行数 DataX速度(Rec/s) DataX流量(MB/s) DataX机器网卡流出流量(MB/s) DataX机器运行负载 DB网卡进入流量(MB/s) DB运行负载 DB TPS 16 128 50124 2.39 5.6 0.40 6.0 2.42 378 16 512 155084 7.40 18.6 1.30 18.9 2.82 325 16 1024 177777 8.48 24.1 1.43 25.5 3.5 233 16 2048 289382 13.8 33.1 2.5 33.5 4.5 150 16 4096 326451 15.52 33.7 1.5 33.9 4.3 80 4.2.4 性能测试小结 批量提交行数（batchSize）对性能影响很大，当 batchSize\u003e=512 之后，单线程写入速度能达到每秒写入一万行 在 batchSize\u003e=512 的基础上，随着通道数的增加（通道数\u003c32），速度呈线性比增加。 通常不建议写入数据库时，通道个数 \u003e32 5 约束限制 FAQ Q: MysqlWriter 执行 postSql 语句报错，那么数据导入到目标数据库了吗?\nA: DataX 导入过程存在三块逻辑，pre 操作、导入操作、post 操作，其中任意一环报错，DataX 作业报错。由于 DataX 不能保证在同一个事务完成上述几个操作，因此有可能数据已经落入到目标端。\nQ: 按照上述说法，那么有部分脏数据导入数据库，如果影响到线上数据库怎么办?\nA: 目前有两种解法，第一种配置 pre 语句，该 sql 可以清理当天导入数据， DataX 每次导入时候可以把上次清理干净并导入完整数据。第二种，向临时表导入数据，完成后再 rename 到线上表。\nQ: 上面第二种方法可以避免对线上数据造成影响，那我具体怎样操作?\nA: 可以配置临时表导入\n",
  "wordCount" : "846",
  "inLanguage": "en",
  "datePublished": "2021-02-02T17:45:01Z",
  "dateModified": "2021-02-02T17:45:01Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://haokiu.com/ee3103b29d5b4fa696cb69e35fefb970/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "haokiu",
    "logo": {
      "@type": "ImageObject",
      "url": "https://haokiu.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://haokiu.com/" accesskey="h" title="haokiu (Alt + H)">haokiu</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://haokiu.com/" title="haokiu">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://haokiu.com/1/" title="1s">
                    <span>后端</span>
                </a>
            </li>
            <li>
                <a href="https://haokiu.com/2/" title="2s">
                    <span>前端</span>
                </a>
            </li>
            <li>
                <a href="https://haokiu.com/3/" title="3s">
                    <span>区块链</span>
                </a>
            </li>
            <li>
                <a href="https://haokiu.com/4/" title="4s">
                    <span>大数据</span>
                </a>
            </li>
            <li>
                <a href="https://haokiu.com/5/" title="5s">
                    <span>linux</span>
                </a>
            </li>
            <li>
                <a href="https://haokiu.com/6/" title="6s">
                    <span>其他</span>
                </a>
            </li>
            <li>
                <a href="https://haokiu.com/tags/" title="Tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://haokiu.com/categories/" title="Categories">
                    <span>categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://haokiu.com/">Home</a>&nbsp;»&nbsp;<a href="https://haokiu.com/4/">4s</a></div>
    <h1 class="post-title">
      DataX MysqlWriter
    </h1>
    <div class="post-meta"><span title='2021-02-02 17:45:01 +0000 UTC'>February 2, 2021</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#datax-mysqlwriter" aria-label="DataX MysqlWriter">DataX MysqlWriter</a><ul>
                        
                <li>
                    <a href="#1-%e5%bf%ab%e9%80%9f%e4%bb%8b%e7%bb%8d" aria-label="1 快速介绍">1 快速介绍</a></li>
                <li>
                    <a href="#2-%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86" aria-label="2 实现原理">2 实现原理</a><ul>
                        <ul>
                        <ul>
                        
                <li>
                    <a href="#%e6%88%96%e8%80%85" aria-label="或者">或者</a></li></ul>
                    </ul>
                    </ul>
                </li>
                <li>
                    <a href="#3-%e5%8a%9f%e8%83%bd%e8%af%b4%e6%98%8e" aria-label="3 功能说明">3 功能说明</a><ul>
                        
                <li>
                    <a href="#31-%e9%85%8d%e7%bd%ae%e6%a0%b7%e4%be%8b" aria-label="3.1 配置样例">3.1 配置样例</a></li>
                <li>
                    <a href="#32-%e5%8f%82%e6%95%b0%e8%af%b4%e6%98%8e" aria-label="3.2 参数说明">3.2 参数说明</a></li>
                <li>
                    <a href="#33-%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2" aria-label="3.3 类型转换">3.3 类型转换</a></li></ul>
                </li>
                <li>
                    <a href="#4-%e6%80%a7%e8%83%bd%e6%8a%a5%e5%91%8a" aria-label="4 性能报告">4 性能报告</a><ul>
                        
                <li>
                    <a href="#41-%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87" aria-label="4.1 环境准备">4.1 环境准备</a><ul>
                        
                <li>
                    <a href="#411-%e6%95%b0%e6%8d%ae%e7%89%b9%e5%be%81" aria-label="4.1.1 数据特征">4.1.1 数据特征</a></li>
                <li>
                    <a href="#412-%e6%9c%ba%e5%99%a8%e5%8f%82%e6%95%b0" aria-label="4.1.2 机器参数">4.1.2 机器参数</a></li>
                <li>
                    <a href="#413-datax-jvm-%e5%8f%82%e6%95%b0" aria-label="4.1.3 DataX jvm 参数">4.1.3 DataX jvm 参数</a></li></ul>
                </li>
                <li>
                    <a href="#42-%e6%b5%8b%e8%af%95%e6%8a%a5%e5%91%8a" aria-label="4.2 测试报告">4.2 测试报告</a><ul>
                        
                <li>
                    <a href="#421-%e5%8d%95%e8%a1%a8%e6%b5%8b%e8%af%95%e6%8a%a5%e5%91%8a" aria-label="4.2.1 单表测试报告">4.2.1 单表测试报告</a></li>
                <li>
                    <a href="#422-%e5%88%86%e8%a1%a8%e6%b5%8b%e8%af%95%e6%8a%a5%e5%91%8a2%e4%b8%aa%e5%88%86%e5%ba%93%e6%af%8f%e4%b8%aa%e5%88%86%e5%ba%934%e5%bc%a0%e5%88%86%e8%a1%a8%e5%85%b1%e8%ae%a18%e5%bc%a0%e5%88%86%e8%a1%a8" aria-label="4.2.2 分表测试报告(2个分库，每个分库4张分表，共计8张分表)">4.2.2 分表测试报告(2个分库，每个分库4张分表，共计8张分表)</a></li>
                <li>
                    <a href="#423-%e5%88%86%e8%a1%a8%e6%b5%8b%e8%af%95%e6%8a%a5%e5%91%8a2%e4%b8%aa%e5%88%86%e5%ba%93%e6%af%8f%e4%b8%aa%e5%88%86%e5%ba%938%e5%bc%a0%e5%88%86%e8%a1%a8%e5%85%b1%e8%ae%a116%e5%bc%a0%e5%88%86%e8%a1%a8" aria-label="4.2.3 分表测试报告(2个分库，每个分库8张分表，共计16张分表)">4.2.3 分表测试报告(2个分库，每个分库8张分表，共计16张分表)</a></li>
                <li>
                    <a href="#424-%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e5%b0%8f%e7%bb%93" aria-label="4.2.4 性能测试小结">4.2.4 性能测试小结</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#5-%e7%ba%a6%e6%9d%9f%e9%99%90%e5%88%b6" aria-label="5 约束限制">5 约束限制</a></li>
                <li>
                    <a href="#faq" aria-label="FAQ">FAQ</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="datax-mysqlwriter">DataX MysqlWriter</h1>
<hr>
<h2 id="1-快速介绍">1 快速介绍</h2>
<p>MysqlWriter 插件实现了写入数据到 Mysql 主库的目的表的功能。在底层实现上， MysqlWriter 通过 JDBC 连接远程 Mysql 数据库，并执行相应的 insert into &hellip; 或者 ( replace into &hellip;) 的 sql 语句将数据写入 Mysql，内部会分批次提交入库，需要数据库本身采用 innodb 引擎。</p>
<p>MysqlWriter 面向ETL开发工程师，他们使用 MysqlWriter 从数仓导入数据到 Mysql。同时 MysqlWriter 亦可以作为数据迁移工具为DBA等用户提供服务。</p>
<h2 id="2-实现原理">2 实现原理</h2>
<p>MysqlWriter 通过 DataX 框架获取 Reader 生成的协议数据，根据你配置的 <code>writeMode</code> 生成</p>
<ul>
<li><code>insert into...</code>(当主键/唯一性索引冲突时会写不进去冲突的行)</li>
</ul>
<h5 id="或者">或者</h5>
<ul>
<li><code>replace into...</code>(没有遇到主键/唯一性索引冲突时，与 insert into 行为一致，冲突时会用新行替换原有行所有字段) 的语句写入数据到 Mysql。出于性能考虑，采用了 <code>PreparedStatement + Batch</code>，并且设置了：<code>rewriteBatchedStatements=true</code>，将数据缓冲到线程上下文 Buffer 中，当 Buffer 累计到预定阈值时，才发起写入请求。</li>
</ul>
<!-- raw HTML omitted -->
<pre><code>注意：目的表所在数据库必须是主库才能写入数据；整个任务至少需要具备 insert/replace into...的权限，是否需要其他权限，取决于你任务配置中在 preSql 和 postSql 中指定的语句。
</code></pre>
<h2 id="3-功能说明">3 功能说明</h2>
<h3 id="31-配置样例">3.1 配置样例</h3>
<ul>
<li>这里使用一份从内存产生到 Mysql 导入的数据。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;job&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;setting&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;speed&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;channel&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;content&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">&#34;reader&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;streamreader&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;parameter&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;column&#34;</span> : [
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;DataX&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>
</span></span><span style="display:flex;"><span>                            },
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">19880808</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;long&#34;</span>
</span></span><span style="display:flex;"><span>                            },
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;1988-08-08 08:08:08&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;date&#34;</span>
</span></span><span style="display:flex;"><span>                            },
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;bool&#34;</span>
</span></span><span style="display:flex;"><span>                            },
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;test&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;bytes&#34;</span>
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;sliceRecordCount&#34;</span>: <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;writer&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;mysqlwriter&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;parameter&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;writeMode&#34;</span>: <span style="color:#e6db74">&#34;insert&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;column&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;id&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;session&#34;</span>: [
</span></span><span style="display:flex;"><span>                        	<span style="color:#e6db74">&#34;set session sql_mode=&#39;ANSI&#39;&#34;</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;preSql&#34;</span>: [
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;delete from test&#34;</span>
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;connection&#34;</span>: [
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;jdbcUrl&#34;</span>: <span style="color:#e6db74">&#34;jdbc:mysql://127.0.0.1:3306/datax?useUnicode=true&amp;characterEncoding=gbk&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;table&#34;</span>: [
</span></span><span style="display:flex;"><span>                                    <span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>                                ]
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        ]
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="32-参数说明">3.2 参数说明</h3>
<ul>
<li>
<p><strong>jdbcUrl</strong></p>
<ul>
<li>
<p>描述：目的数据库的 JDBC 连接信息。作业运行时，DataX 会在你提供的 jdbcUrl 后面追加如下属性：yearIsDateType=false&amp;zeroDateTimeBehavior=convertToNull&amp;rewriteBatchedStatements=true</p>
<pre><code>     注意：1、在一个数据库上只能配置一个 jdbcUrl 值。这与 MysqlReader 支持多个备库探测不同，因为此处不支持同一个数据库存在多个主库的情况(双主导入数据情况)
          2、jdbcUrl按照Mysql官方规范，并可以填写连接附加控制信息，比如想指定连接编码为 gbk ，则在 jdbcUrl 后面追加属性 useUnicode=true&amp;characterEncoding=gbk。具体请参看 Mysql官方文档或者咨询对应 DBA。
</code></pre>
</li>
<li>
<p>必选：是 <!-- raw HTML omitted --></p>
</li>
<li>
<p>默认值：无 <!-- raw HTML omitted --></p>
</li>
</ul>
</li>
<li>
<p><strong>username</strong></p>
<ul>
<li>
<p>描述：目的数据库的用户名 <!-- raw HTML omitted --></p>
</li>
<li>
<p>必选：是 <!-- raw HTML omitted --></p>
</li>
<li>
<p>默认值：无 <!-- raw HTML omitted --></p>
</li>
</ul>
</li>
<li>
<p><strong>password</strong></p>
<ul>
<li>
<p>描述：目的数据库的密码 <!-- raw HTML omitted --></p>
</li>
<li>
<p>必选：是 <!-- raw HTML omitted --></p>
</li>
<li>
<p>默认值：无 <!-- raw HTML omitted --></p>
</li>
</ul>
</li>
<li>
<p><strong>table</strong></p>
<ul>
<li>
<p>描述：目的表的表名称。支持写入一个或者多个表。当配置为多张表时，必须确保所有表结构保持一致。</p>
<pre><code>     注意：table 和 jdbcUrl 必须包含在 connection 配置单元中
</code></pre>
</li>
<li>
<p>必选：是 <!-- raw HTML omitted --></p>
</li>
<li>
<p>默认值：无 <!-- raw HTML omitted --></p>
</li>
</ul>
</li>
<li>
<p><strong>column</strong></p>
<ul>
<li>
<p>描述：目的表需要写入数据的字段,字段之间用英文逗号分隔。例如: &ldquo;column&rdquo;: [&ldquo;id&rdquo;,&ldquo;name&rdquo;,&ldquo;age&rdquo;]。如果要依次写入全部列，使用<code>*</code>表示, 例如: <code>&quot;column&quot;: [&quot;*&quot;]</code>。</p>
<pre><code>  **column配置项必须指定，不能留空！**

     注意：1、我们强烈不推荐你这样配置，因为当你目的表字段个数、类型等有改动时，你的任务可能运行不正确或者失败
          2、 column 不能配置任何常量值
</code></pre>
</li>
<li>
<p>必选：是 <!-- raw HTML omitted --></p>
</li>
<li>
<p>默认值：否 <!-- raw HTML omitted --></p>
</li>
</ul>
</li>
<li>
<p><strong>session</strong></p>
<ul>
<li>
<p>描述: DataX在获取Mysql连接时，执行session指定的SQL语句，修改当前connection session属性</p>
</li>
<li>
<p>必须: 否</p>
</li>
<li>
<p>默认值: 空</p>
</li>
</ul>
</li>
<li>
<p><strong>preSql</strong></p>
<ul>
<li>
<p>描述：写入数据到目的表前，会先执行这里的标准语句。如果 Sql 中有你需要操作到的表名称，请使用 <code>@table</code> 表示，这样在实际执行 Sql 语句时，会对变量按照实际表名称进行替换。比如你的任务是要写入到目的端的100个同构分表(表名称为:datax_00,datax01, &hellip; datax_98,datax_99)，并且你希望导入数据前，先对表中数据进行删除操作，那么你可以这样配置：<code>&quot;preSql&quot;:[&quot;delete from 表名&quot;]</code>，效果是：在执行到每个表写入数据前，会先执行对应的 delete from 对应表名称 <!-- raw HTML omitted --></p>
</li>
<li>
<p>必选：否 <!-- raw HTML omitted --></p>
</li>
<li>
<p>默认值：无 <!-- raw HTML omitted --></p>
</li>
</ul>
</li>
<li>
<p><strong>postSql</strong></p>
<ul>
<li>
<p>描述：写入数据到目的表后，会执行这里的标准语句。（原理同 preSql ） <!-- raw HTML omitted --></p>
</li>
<li>
<p>必选：否 <!-- raw HTML omitted --></p>
</li>
<li>
<p>默认值：无 <!-- raw HTML omitted --></p>
</li>
</ul>
</li>
<li>
<p><strong>writeMode</strong></p>
<ul>
<li>
<p>描述：控制写入数据到目标表采用 <code>insert into</code> 或者 <code>replace into</code> 或者 <code>ON DUPLICATE KEY UPDATE</code> 语句<!-- raw HTML omitted --></p>
</li>
<li>
<p>必选：是 <!-- raw HTML omitted --></p>
</li>
<li>
<p>所有选项：insert/replace/update <!-- raw HTML omitted --></p>
</li>
<li>
<p>默认值：insert <!-- raw HTML omitted --></p>
</li>
</ul>
</li>
<li>
<p><strong>batchSize</strong></p>
<ul>
<li>
<p>描述：一次性批量提交的记录数大小，该值可以极大减少DataX与Mysql的网络交互次数，并提升整体吞吐量。但是该值设置过大可能会造成DataX运行进程OOM情况。<!-- raw HTML omitted --></p>
</li>
<li>
<p>必选：否 <!-- raw HTML omitted --></p>
</li>
<li>
<p>默认值：1024 <!-- raw HTML omitted --></p>
</li>
</ul>
</li>
</ul>
<h3 id="33-类型转换">3.3 类型转换</h3>
<p>类似 MysqlReader ，目前 MysqlWriter 支持大部分 Mysql 类型，但也存在部分个别类型没有支持的情况，请注意检查你的类型。</p>
<p>下面列出 MysqlWriter 针对 Mysql 类型转换列表:</p>
<table>
<thead>
<tr>
<th>DataX 内部类型</th>
<th>Mysql 数据类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>Long</td>
<td>int, tinyint, smallint, mediumint, int, bigint, year</td>
</tr>
<tr>
<td>Double</td>
<td>float, double, decimal</td>
</tr>
<tr>
<td>String</td>
<td>varchar, char, tinytext, text, mediumtext, longtext</td>
</tr>
<tr>
<td>Date</td>
<td>date, datetime, timestamp, time</td>
</tr>
<tr>
<td>Boolean</td>
<td>bit, bool</td>
</tr>
<tr>
<td>Bytes</td>
<td>tinyblob, mediumblob, blob, longblob, varbinary</td>
</tr>
</tbody>
</table>
<ul>
<li><code>bit类型目前是未定义类型转换</code></li>
</ul>
<h2 id="4-性能报告">4 性能报告</h2>
<h3 id="41-环境准备">4.1 环境准备</h3>
<h4 id="411-数据特征">4.1.1 数据特征</h4>
<p>建表语句：</p>
<pre><code>CREATE TABLE `datax_mysqlwriter_perf_00` (
`biz_order_id` bigint(20) NOT NULL AUTO_INCREMENT  COMMENT 'id',
`key_value` varchar(4000) NOT NULL COMMENT 'Key-value的内容',
`gmt_create` datetime NOT NULL COMMENT '创建时间',
`gmt_modified` datetime NOT NULL COMMENT '修改时间',
`attribute_cc` int(11) DEFAULT NULL COMMENT '防止并发修改的标志',
`value_type` int(11) NOT NULL DEFAULT '0' COMMENT '类型',
`buyer_id` bigint(20) DEFAULT NULL COMMENT 'buyerid',
`seller_id` bigint(20) DEFAULT NULL COMMENT 'seller_id',
PRIMARY KEY (`biz_order_id`,`value_type`),
KEY `idx_biz_vertical_gmtmodified` (`gmt_modified`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='datax perf test'
</code></pre>
<p>单行记录类似于：</p>
<pre><code>   key_value: ;orderIds:20148888888,2014888888813800;
  gmt_create: 2011-09-24 11:07:20
gmt_modified: 2011-10-24 17:56:34
attribute_cc: 1
  value_type: 3
	buyer_id: 8888888
   seller_id: 1
</code></pre>
<h4 id="412-机器参数">4.1.2 机器参数</h4>
<ul>
<li>
<p>执行DataX的机器参数为:</p>
<ol>
<li>cpu: 24核 Intel(R) Xeon(R) CPU E5-2630 0 @ 2.30GHz</li>
<li>mem: 48GB</li>
<li>net: 千兆双网卡</li>
<li>disc: DataX 数据不落磁盘，不统计此项</li>
</ol>
</li>
<li>
<p>Mysql数据库机器参数为:</p>
<ol>
<li>cpu: 32核 Intel(R) Xeon(R) CPU E5-2650 v2 @ 2.60GHz</li>
<li>mem: 256GB</li>
<li>net: 千兆双网卡</li>
<li>disc: BTWL419303E2800RGN  INTEL SSDSC2BB800G4   D2010370</li>
</ol>
</li>
</ul>
<h4 id="413-datax-jvm-参数">4.1.3 DataX jvm 参数</h4>
<pre><code>-Xms1024m -Xmx1024m -XX:+HeapDumpOnOutOfMemoryError
</code></pre>
<h3 id="42-测试报告">4.2 测试报告</h3>
<h4 id="421-单表测试报告">4.2.1 单表测试报告</h4>
<table>
<thead>
<tr>
<th>通道数</th>
<th>批量提交行数</th>
<th>DataX速度(Rec/s)</th>
<th>DataX流量(MB/s)</th>
<th>DataX机器网卡流出流量(MB/s)</th>
<th>DataX机器运行负载</th>
<th>DB网卡进入流量(MB/s)</th>
<th>DB运行负载</th>
<th>DB TPS</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>128</td>
<td>5319</td>
<td>0.260</td>
<td>0.580</td>
<td>0.05</td>
<td>0.620</td>
<td>0.5</td>
<td>50</td>
</tr>
<tr>
<td>1</td>
<td>512</td>
<td>14285</td>
<td>0.697</td>
<td>1.6</td>
<td>0.12</td>
<td>1.6</td>
<td>0.6</td>
<td>28</td>
</tr>
<tr>
<td>1</td>
<td>1024</td>
<td>17241</td>
<td>0.842</td>
<td>1.9</td>
<td>0.20</td>
<td>1.9</td>
<td>0.6</td>
<td>16</td>
</tr>
<tr>
<td>1</td>
<td>2048</td>
<td>31250</td>
<td>1.49</td>
<td>2.8</td>
<td>0.15</td>
<td>3.0</td>
<td>0.8</td>
<td>15</td>
</tr>
<tr>
<td>1</td>
<td>4096</td>
<td>31250</td>
<td>1.49</td>
<td>3.5</td>
<td>0.20</td>
<td>3.6</td>
<td>0.8</td>
<td>8</td>
</tr>
<tr>
<td>4</td>
<td>128</td>
<td>11764</td>
<td>0.574</td>
<td>1.5</td>
<td>0.21</td>
<td>1.6</td>
<td>0.8</td>
<td>112</td>
</tr>
<tr>
<td>4</td>
<td>512</td>
<td>30769</td>
<td>1.47</td>
<td>3.5</td>
<td>0.3</td>
<td>3.6</td>
<td>0.9</td>
<td>88</td>
</tr>
<tr>
<td>4</td>
<td>1024</td>
<td>50000</td>
<td>2.38</td>
<td>5.4</td>
<td>0.3</td>
<td>5.5</td>
<td>1.0</td>
<td>66</td>
</tr>
<tr>
<td>4</td>
<td>2048</td>
<td>66666</td>
<td>3.18</td>
<td>7.0</td>
<td>0.3</td>
<td>7.1</td>
<td>1.37</td>
<td>46</td>
</tr>
<tr>
<td>4</td>
<td>4096</td>
<td>80000</td>
<td>3.81</td>
<td>7.3</td>
<td>0.5</td>
<td>7.3</td>
<td>1.40</td>
<td>26</td>
</tr>
<tr>
<td>8</td>
<td>128</td>
<td>17777</td>
<td>0.868</td>
<td>2.9</td>
<td>0.28</td>
<td>2.9</td>
<td>0.8</td>
<td>200</td>
</tr>
<tr>
<td>8</td>
<td>512</td>
<td>57142</td>
<td>2.72</td>
<td>8.5</td>
<td>0.5</td>
<td>8.5</td>
<td>0.70</td>
<td>159</td>
</tr>
<tr>
<td>8</td>
<td>1024</td>
<td>88888</td>
<td>4.24</td>
<td>12.2</td>
<td>0.9</td>
<td>12.4</td>
<td>1.0</td>
<td>108</td>
</tr>
<tr>
<td>8</td>
<td>2048</td>
<td>133333</td>
<td>6.36</td>
<td>14.7</td>
<td>0.9</td>
<td>14.7</td>
<td>1.0</td>
<td>81</td>
</tr>
<tr>
<td>8</td>
<td>4096</td>
<td>166666</td>
<td>7.95</td>
<td>19.5</td>
<td>0.9</td>
<td>19.5</td>
<td>3.0</td>
<td>45</td>
</tr>
<tr>
<td>16</td>
<td>128</td>
<td>32000</td>
<td>1.53</td>
<td>3.3</td>
<td>0.6</td>
<td>3.4</td>
<td>0.88</td>
<td>401</td>
</tr>
<tr>
<td>16</td>
<td>512</td>
<td>106666</td>
<td>5.09</td>
<td>16.1</td>
<td>0.9</td>
<td>16.2</td>
<td>2.16</td>
<td>260</td>
</tr>
<tr>
<td>16</td>
<td>1024</td>
<td>173913</td>
<td>8.29</td>
<td>22.1</td>
<td>1.5</td>
<td>22.2</td>
<td>4.5</td>
<td>200</td>
</tr>
<tr>
<td>16</td>
<td>2048</td>
<td>228571</td>
<td>10.90</td>
<td>28.6</td>
<td>1.61</td>
<td>28.7</td>
<td>4.60</td>
<td>128</td>
</tr>
<tr>
<td>16</td>
<td>4096</td>
<td>246153</td>
<td>11.74</td>
<td>31.1</td>
<td>1.65</td>
<td>31.2</td>
<td>4.66</td>
<td>57</td>
</tr>
<tr>
<td>32</td>
<td>1024</td>
<td>246153</td>
<td>11.74</td>
<td>30.5</td>
<td>3.17</td>
<td>30.7</td>
<td>12.10</td>
<td>270</td>
</tr>
</tbody>
</table>
<p>说明：</p>
<ol>
<li>这里的单表，主键类型为 bigint(20),自增。</li>
<li>batchSize 和 通道个数，对性能影响较大。</li>
<li>16通道，4096批量提交时，出现 full gc 2次。</li>
</ol>
<h4 id="422-分表测试报告2个分库每个分库4张分表共计8张分表">4.2.2 分表测试报告(2个分库，每个分库4张分表，共计8张分表)</h4>
<table>
<thead>
<tr>
<th>通道数</th>
<th>批量提交行数</th>
<th>DataX速度(Rec/s)</th>
<th>DataX流量(MB/s)</th>
<th>DataX机器网卡流出流量(MB/s)</th>
<th>DataX机器运行负载</th>
<th>DB网卡进入流量(MB/s)</th>
<th>DB运行负载</th>
<th>DB TPS</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
<td>128</td>
<td>26764</td>
<td>1.28</td>
<td>2.9</td>
<td>0.5</td>
<td>3.0</td>
<td>0.8</td>
<td>209</td>
</tr>
<tr>
<td>8</td>
<td>512</td>
<td>95180</td>
<td>4.54</td>
<td>10.5</td>
<td>0.7</td>
<td>10.9</td>
<td>0.8</td>
<td>188</td>
</tr>
<tr>
<td>8</td>
<td>1024</td>
<td>94117</td>
<td>4.49</td>
<td>12.3</td>
<td>0.6</td>
<td>12.4</td>
<td>1.09</td>
<td>120</td>
</tr>
<tr>
<td>8</td>
<td>2048</td>
<td>133333</td>
<td>6.36</td>
<td>19.4</td>
<td>0.9</td>
<td>19.5</td>
<td>1.35</td>
<td>85</td>
</tr>
<tr>
<td>8</td>
<td>4096</td>
<td>191692</td>
<td>9.14</td>
<td>22.1</td>
<td>1.0</td>
<td>22.2</td>
<td>1.45</td>
<td>45</td>
</tr>
</tbody>
</table>
<h4 id="423-分表测试报告2个分库每个分库8张分表共计16张分表">4.2.3 分表测试报告(2个分库，每个分库8张分表，共计16张分表)</h4>
<table>
<thead>
<tr>
<th>通道数</th>
<th>批量提交行数</th>
<th>DataX速度(Rec/s)</th>
<th>DataX流量(MB/s)</th>
<th>DataX机器网卡流出流量(MB/s)</th>
<th>DataX机器运行负载</th>
<th>DB网卡进入流量(MB/s)</th>
<th>DB运行负载</th>
<th>DB TPS</th>
</tr>
</thead>
<tbody>
<tr>
<td>16</td>
<td>128</td>
<td>50124</td>
<td>2.39</td>
<td>5.6</td>
<td>0.40</td>
<td>6.0</td>
<td>2.42</td>
<td>378</td>
</tr>
<tr>
<td>16</td>
<td>512</td>
<td>155084</td>
<td>7.40</td>
<td>18.6</td>
<td>1.30</td>
<td>18.9</td>
<td>2.82</td>
<td>325</td>
</tr>
<tr>
<td>16</td>
<td>1024</td>
<td>177777</td>
<td>8.48</td>
<td>24.1</td>
<td>1.43</td>
<td>25.5</td>
<td>3.5</td>
<td>233</td>
</tr>
<tr>
<td>16</td>
<td>2048</td>
<td>289382</td>
<td>13.8</td>
<td>33.1</td>
<td>2.5</td>
<td>33.5</td>
<td>4.5</td>
<td>150</td>
</tr>
<tr>
<td>16</td>
<td>4096</td>
<td>326451</td>
<td>15.52</td>
<td>33.7</td>
<td>1.5</td>
<td>33.9</td>
<td>4.3</td>
<td>80</td>
</tr>
</tbody>
</table>
<h4 id="424-性能测试小结">4.2.4 性能测试小结</h4>
<ol>
<li>批量提交行数（batchSize）对性能影响很大，当 <code>batchSize&gt;=512</code> 之后，单线程写入速度能达到每秒写入一万行</li>
<li>在 <code>batchSize&gt;=512</code> 的基础上，随着通道数的增加（通道数&lt;32），速度呈线性比增加。</li>
<li><code>通常不建议写入数据库时，通道个数 &gt;32</code></li>
</ol>
<h2 id="5-约束限制">5 约束限制</h2>
<h2 id="faq">FAQ</h2>
<hr>
<p><strong>Q: MysqlWriter 执行 postSql 语句报错，那么数据导入到目标数据库了吗?</strong></p>
<p>A: DataX 导入过程存在三块逻辑，pre 操作、导入操作、post 操作，其中任意一环报错，DataX 作业报错。由于 DataX 不能保证在同一个事务完成上述几个操作，因此有可能数据已经落入到目标端。</p>
<hr>
<p><strong>Q: 按照上述说法，那么有部分脏数据导入数据库，如果影响到线上数据库怎么办?</strong></p>
<p>A: 目前有两种解法，第一种配置 pre 语句，该 sql 可以清理当天导入数据， DataX 每次导入时候可以把上次清理干净并导入完整数据。第二种，向临时表导入数据，完成后再 rename 到线上表。</p>
<hr>
<p><strong>Q: 上面第二种方法可以避免对线上数据造成影响，那我具体怎样操作?</strong></p>
<p>A: 可以配置临时表导入</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://haokiu.com/tags/datax/">datax</a></li>
    </ul>

  </footer>
</article>
    </main>
    
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
